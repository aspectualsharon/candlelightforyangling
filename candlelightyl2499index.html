<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>丽江志异·响荷 Candlelight</title>
    <style>
        body {
            font-family: 'SimSun', '宋体', serif;
            background-color: #f5f5f0;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-size: cover;
            line-height: 1.6;
        }

        .game-container {
            background-color: rgba(255, 255, 255, 0.8);
            padding: 30px;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            border: 1px solid #d4c9a8;
        }

        h1, h2, h3 {
            color: #8B0000;
            text-align: center;
            font-weight: normal;
        }

        h1 {
            border-bottom: 1px solid #8B0000;
            padding-bottom: 10px;
        }

        .scene {
            display: none;
            margin-bottom: 20px;
        }

        .active {
            display: block;
        }

        .choice {
            background-color: #f0e6d2;
            border: 1px solid #d4c9a8;
            padding: 12px;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 3px;
        }

            .choice:hover {
                background-color: #e6d8b5;
                transform: translateX(5px);
            }

        .character-select {
            text-align: center;
            margin: 30px 0;
        }

        .character-btn {
            padding: 12px 25px;
            margin: 0 15px;
            background-color: #8B0000;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 3px;
            font-size: 16px;
            transition: background-color 0.3s;
        }

            .character-btn:hover {
                background-color: #6d0000;
            }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #e6d8b5;
            border-radius: 5px;
            font-size: 14px;
        }

        .stat {
            text-align: center;
        }

        .achievement {
            color: #8B0000;
            font-weight: bold;
            margin: 5px 0;
        }

        .ending {
            text-align: center;
            font-size: 1.2em;
            margin: 30px 0;
            padding: 20px;
            background-color: #f0e6d2;
            border-radius: 5px;
        }

        .restart-btn {
            display: block;
            margin: 20px auto;
            padding: 12px 25px;
            background-color: #8B0000;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 3px;
            font-size: 16px;
        }

        .scene-image {
            width: 100%;
            max-height: 300px;
            object-fit: cover;
            border-radius: 5px;
            margin: 15px 0;
            border: 1px solid #d4c9a8;
        }

        .dialogue {
            font-style: italic;
            margin: 10px 0;
            padding-left: 20px;
            border-left: 2px solid #8B0000;
        }

        .action {
            font-weight: bold;
            color: #8B0000;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>丽江志异 响荷 Candlelight</h1>

        <div id="intro" class="scene active">
            <h2>游戏概述</h2>
            <p>这是一款基于《丽江志异·响荷 Candlelight》的互动小说游戏，玩家将体验李振洋（木子洋）和李英超（灵超）在丽江遭遇超自然事件的故事。</p>
            <p>游戏共6天循环，每天呈现不同场景，你的选择将影响最终结局和成就解锁。</p>
            <div class="choice" id="startButton">开始游戏</div>
        </div>

        <!-- Day 1: Interview at the Lodge -->
        <div id="day1" class="scene">
            <h2>第1天：丽江民宿采访</h2>
            <p>铅云密布的丽江午后，铅灰色的天空压得很低，冻雨在窗外淅淅沥沥地下着。你坐在民宿的落地窗前，窗外是苍莽的远山。采访者正在询问关于你们关系的问题...</p>

            <div class="character-select">
                <h3>选择你要扮演的角色：</h3>
                <button class="character-btn" data-char="木子洋">李振洋（木子洋）</button>
                <button class="character-btn" data-char="灵超">李英超（灵超）</button>
            </div>

            <div id="day1-mu" class="character-choices hidden">
                <div class="dialogue">"粉丝们很好奇你们之间的关系，能简单说说吗？"采访者问道，录音笔的红灯一闪一闪。</div>
                <div class="choice" data-day="1" data-choice="professional">
                    <span class="action">保持专业的回答：</span>"我们只是工作伙伴关系。"
                </div>
                <div class="choice" data-day="1" data-choice="intimate">
                    <span class="action">流露亲密感：</span>"我们认识很多年了，关系很好。"
                </div>
                <div class="choice" data-day="1" data-choice="evasive">
                    <span class="action">回避问题：</span>"你们不会以为我们真的是那样吧？"（带着戏谑的语气）
                </div>
            </div>

            <div id="day1-ling" class="character-choices hidden">
                <p>你从雨中归来，黑色夹克上还挂着雨珠。助理在外面拦着几个粉丝，你快步穿过大堂，看到木子洋正在落地窗前接受采访...</p>
                <div class="choice" data-day="1" data-choice="ignore">
                    <span class="action">直接回房间</span> - 你今天心情不太好，不想参与采访
                </div>
                <div class="choice" data-day="1" data-choice="join">
                    <span class="action">加入采访互动</span> - 走过去自然地坐在木子洋旁边
                </div>
                <div class="choice" data-day="1" data-choice="tease">
                    <span class="action">调侃木子洋：</span>"那个问题我看了，你怎么跟他们说的，什么我们什么关系？"
                </div>
            </div>
        </div>

        <!-- Day 2: Visiting the Medium -->
        <div id="day2" class="scene">
            <h2>第2天：拜访灵媒十四妹</h2>
            <p>冻雨连绵的丽江暮夏，寒气钻入骨髓。你们来到灵媒十四妹位于巷弄深处的古老宅院。屋内薰香缭绕，烛光摇曳，墙上挂满各种神秘的符咒和法器。</p>

            <div class="character-select">
                <h3>选择你要扮演的角色：</h3>
                <button class="character-btn" data-char="木子洋">李振洋（木子洋）</button>
                <button class="character-btn" data-char="灵超">李英超（灵超）</button>
            </div>

            <div id="day2-mu" class="character-choices hidden">
                <p>十四妹拿出取血簪，准备开始仪式。她粗糙的手指捏着那枚造型古朴的银簪，在烛光下闪着诡异的光。</p>
                <div class="choice" data-day="2" data-choice="stop">
                    <span class="action">阻止放血仪式</span> - 这看起来太危险了
                </div>
                <div class="choice" data-day="2" data-choice="continue">
                    <span class="action">坚持完成仪式</span> - 来都来了，试试看吧
                </div>
                <div class="choice" data-day="2" data-choice="question">
                    <span class="action">质疑十四妹：</span>"你确定这安全吗？"
                </div>
            </div>

            <div id="day2-ling" class="character-choices hidden">
                <p>十四妹告诉你："响荷会选最合适的路..."她的声音像陈旧的木门合页转动。你感觉手腕被她凉丝丝的手握住，那枚取血簪已经抵在你的掌心。</p>
                <div class="choice" data-day="2" data-choice="fear">
                    <span class="action">感到恐惧，想离开</span> - 这地方让你浑身不舒服
                </div>
                <div class="choice" data-day="2" data-choice="curious">
                    <span class="action">保持好奇，继续仪式</span> - 或许真能带来好运
                </div>
                <div class="choice" data-day="2" data-choice="lookAtMu">
                    <span class="action">看向木子洋</span> - 用眼神询问他的意见
                </div>
            </div>

            <div id="day2-shared" class="hidden">
                <p>十四妹带你们进入里屋，点燃一支特制的蜡烛。借着烛光，你们看到天花板上悬挂着数十块绘有孩童肖像的木板，在微风中轻轻碰撞，发出诡异的咿呀声。</p>
                <div class="choice" data-day="2" data-choice="takeChild">
                    <span class="action">接过响荷的木牌</span> - 小心翼翼地接过那块绘有女童的木板
                </div>
                <div class="choice" data-day="2" data-choice="refuse">
                    <span class="action">拒绝接受</span> - 这太诡异了，你们转身离开
                </div>
            </div>
        </div>

        <!-- Day 3: Elevator Incident -->
        <div id="day3" class="scene">
            <h2>第3天：电梯惊魂</h2>
            <p>从十四妹处回来后，你们乘电梯回酒店房间。电梯门关上后，你注意到镜面墙壁上的倒影有些不对劲...</p>

            <div id="day3-mu" class="character-choices hidden">
                <p>你突然发现电梯镜子里只有你自己的倒影，灵超的身影消失了。角落里，一个穿碎花裙的小女孩正蹲在那里，浑身湿透。</p>
                <div class="choice" data-day="3" data-choice="panic">
                    <span class="action">惊慌寻找</span> - 大声呼喊灵超的名字
                </div>
                <div class="choice" data-day="3" data-choice="calm">
                    <span class="action">冷静应对</span> - 仔细观察小女孩的举动
                </div>
                <div class="choice" data-day="3" data-choice="talkToChild">
                    <span class="action">询问小女孩：</span>"你看到灵超了吗？"
                </div>
            </div>

            <div id="day3-ling" class="character-choices hidden">
                <p>电梯门关上后，你感觉一阵刺骨寒意。从镜子里，你看到自己身后站着一个穿碎花裙的小女孩，正伸手想拉你的衣角。</p>
                <div class="choice" data-day="3" data-choice="freeze">
                    <span class="action">僵在原地</span> - 恐惧让你无法动弹
                </div>
                <div class="choice" data-day="3" data-choice="talk">
                    <span class="action">尝试沟通：</span>"你想干什么？"
                </div>
                <div class="choice" data-day="3" data-choice="pressButton">
                    <span class="action">猛按开门按钮</span> - 想立刻逃离电梯
                </div>
            </div>
        </div>

        <!-- 其他天数场景保持不变 -->
        <!-- Day 4: Bar Fortune Teller -->
        <div id="day4" class="scene">
            <h2>第4天：酒吧算命</h2>
            <p>石锅鱼晚餐后，团队提议去酒吧放松。这家酒吧装饰奇特，每张桌子都有一盏不同月相的灯。角落里坐着一位据说很灵验的算命师傅。</p>

            <div id="day4-mu" class="character-choices hidden">
                <p>算命师傅的桌前摆着一个古老的罗盘。自从电梯事件后，你开始频繁看到那个穿碎花裙的小女孩。</p>
                <div class="choice" data-day="4" data-choice="consult">
                    <span class="action">寻求算命帮助</span> - 或许她能解释这些现象
                </div>
                <div class="choice" data-day="4" data-choice="rational">
                    <span class="action">坚持理性</span> - 这只是压力产生的幻觉
                </div>
                <div class="choice" data-day="4" data-choice="watchLing">
                    <span class="action">观察灵超</span> - 他似乎也看到了什么
                </div>
            </div>

            <div id="day4-ling" class="character-choices hidden">
                <p>你已经喝了几杯，两颧通红。算命师傅头顶的新月灯投下诡异的光影。你注意到木子洋正若有所思地看着你。</p>
                <div class="choice" data-day="4" data-choice="share">
                    <span class="action">分享担忧</span> - 向算命师傅倾诉你的恐惧
                </div>
                <div class="choice" data-day="4" data-choice="silent">
                    <span class="action">保持沉默</span> - 不想在公开场合讨论这些
                </div>
                <div class="choice" data-day="4" data-choice="confrontMu">
                    <span class="action">质问木子洋：</span>"你也看到了，对吧？"
                </div>
            </div>
        </div>

        <!-- Day 5: Wedding Day -->
        <div id="day5" class="scene">
            <h2>第5天：婚礼抉择</h2>
            <p>木子洋结婚当日。婚礼现场装饰华丽，宾客满座。你却接到灵超的电话——他的车在半路抛锚了。</p>

            <div id="day5-mu" class="character-choices hidden">
                <p>你穿着婚礼西装，领结松松挂着。电话那头，灵超的声音听起来有些慌乱。自从请了响荷，事情变得越来越不对劲。</p>
                <div class="choice" data-day="5" data-choice="stay">
                    <span class="action">完成婚礼仪式</span> - 让助理去帮灵超
                </div>
                <div class="choice" data-day="5" data-choice="leave">
                    <span class="action">追寻灵超</span> - 亲自去接他
                </div>
                <div class="choice" data-day="5" data-choice="sendSiMing">
                    <span class="action">派斯明去</span> - 她或许知道怎么处理这些怪事
                </div>
            </div>

            <div id="day5-ling" class="character-choices hidden">
                <p>你的车抛锚在荒僻的路段，手机信号时有时无。后视镜里，那个穿碎花裙的小女孩正坐在后座，直勾勾地看着你。</p>
                <div class="choice" data-day="5" data-choice="escape">
                    <span class="action">逃避现实</span> - 谎称要去参加同学生日
                </div>
                <div class="choice" data-day="5" data-choice="face">
                    <span class="action">直面问题</span> - 打电话向木子洋求助
                </div>
                <div class="choice" data-day="5" data-choice="driveAway">
                    <span class="action">开车离开</span> - 不管去哪，先离开这里
                </div>
            </div>
        </div>

        <!-- Day 6: Final Confrontation -->
        <div id="day6" class="scene">
            <h2>第6天：最终抉择</h2>
            <p>斯明和张志蘅找到你。斯明手中拿着那枚古老的取血簪，上面刻着繁复的纹路。她告诉你，必须做出选择了。</p>

            <div id="day6-mu" class="character-choices hidden">
                <p>"小鬼分很多种，"斯明说道，"有一种，是一定要拉一个下去的。"她手中的簪子在月光下闪着寒光。</p>
                <div class="choice" data-day="6" data-choice="letgo">
                    <span class="action">放手，接受分离</span> - 让灵超安息
                </div>
                <div class="choice" data-day="6" data-choice="holdon">
                    <span class="action">坚持不放手</span> - 即使代价是永远被响荷纠缠
                </div>
                <div class="choice" data-day="6" data-choice="sacrifice">
                    <span class="action">牺牲自己</span> - 代替灵超跟响荷走
                </div>
            </div>

            <div id="day6-ling" class="character-choices hidden">
                <p>"你不能让人家没法儿过日子，"张志蘅醉醺醺地说。斯明将取血簪递给你，上面的符文开始微微发光。</p>
                <div class="choice" data-day="6" data-choice="leave">
                    <span class="action">选择离开</span> - 接受命运的安排
                </div>
                <div class="choice" data-day="6" data-choice="stay">
                    <span class="action">坚持留下</span> - 拒绝接受这个结局
                </div>
                <div class="choice" data-day="6" data-choice="takeHer">
                    <span class="action">带走响荷</span> - 让她永远跟着你，放过木子洋
                </div>
            </div>
        </div>

        <!-- Ending Scene -->
        <div id="ending" class="scene">
            <h2>结局</h2>
            <div class="ending" id="ending-text"></div>
            <div id="achievements">
                <h3>解锁成就：</h3>
                <div id="achievements-list"></div>
            </div>
            <button class="restart-btn" id="restartButton">重新开始</button>
        </div>

        <!-- Game Stats -->
        <div class="stats">
            <div class="stat">天数: <span id="day-counter">1</span>/6</div>
            <div class="stat">关系值: <span id="relationship">50</span></div>
            <div class="stat">超自然值: <span id="supernatural">50</span></div>
            <div class="stat">理智值: <span id="sanity">50</span></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 游戏状态
            let gameState = {
                day: 1,
                character: null,
                relationship: 50,
                supernatural: 50,
                sanity: 50,
                choices: [],
                achievements: [],
                hasSeenChild: false,
                tookAmulet: false
            };

            // 更新状态显示
            function updateStats() {
                document.getElementById('day-counter').textContent = gameState.day;
                document.getElementById('relationship').textContent = gameState.relationship;
                document.getElementById('supernatural').textContent = gameState.supernatural;
                document.getElementById('sanity').textContent = gameState.sanity;
            }

            // 开始游戏
            function startGame() {
                document.getElementById('intro').classList.remove('active');
                document.getElementById('day1').classList.add('active');
                updateStats();
            }

            // 选择角色 - 重点修复部分
            function selectCharacter(char) {
                gameState.character = char;
                // 隐藏所有角色选项
                document.querySelectorAll('.character-choices').forEach(el => el.classList.add('hidden'));
                // 隐藏共享场景（如果显示的话）
                document.getElementById('day2-shared').classList.add('hidden');
                
                // 显示当前角色的选项
                const charElement = document.getElementById(`day${gameState.day}-${char === '木子洋' ? 'mu' : 'ling'}`);
                if (charElement) {
                    charElement.classList.remove('hidden');
                }
            }

            // 做出选择
            function makeChoice(day, choice) {
                gameState.choices.push({ day, choice });
                updateGameState(day, choice);
                checkAchievements(day, choice);
                
                // 处理第二天的特殊流程：角色选择后显示共享场景
                if (day === 2 && !(choice === 'takeChild' || choice === 'refuse')) {
                    // 显示共享场景
                    document.querySelectorAll('.character-choices').forEach(el => el.classList.add('hidden'));
                    document.getElementById('day2-shared').classList.remove('hidden');
                } else if (day < 6) {
                    // 其他情况推进到下一天
                    gameState.day = day + 1;
                    goToNextDay();
                } else {
                    // 最后一天显示结局
                    showEnding();
                }
            }

            // 更新游戏状态值
            function updateGameState(day, choice) {
                // 第1天的选择影响
                if (day === 1) {
                    switch(choice) {
                        case 'professional':
                            gameState.relationship -= 10;
                            gameState.sanity += 5;
                            break;
                        case 'intimate':
                            gameState.relationship += 15;
                            gameState.supernatural += 5;
                            break;
                        case 'evasive':
                            gameState.relationship += 5;
                            gameState.sanity -= 5;
                            break;
                        case 'ignore':
                            gameState.relationship -= 15;
                            gameState.sanity -= 5;
                            break;
                        case 'join':
                            gameState.relationship += 10;
                            gameState.sanity += 5;
                            break;
                        case 'tease':
                            gameState.relationship += 5;
                            gameState.supernatural += 5;
                            break;
                    }
                }
                // 第2天的选择影响
                else if (day === 2) {
                    switch(choice) {
                        case 'stop':
                            gameState.sanity += 10;
                            gameState.supernatural -= 10;
                            break;
                        case 'continue':
                            gameState.sanity -= 10;
                            gameState.supernatural += 10;
                            gameState.tookAmulet = true;
                            break;
                        case 'question':
                            gameState.sanity += 5;
                            gameState.supernatural += 5;
                            break;
                        case 'fear':
                            gameState.sanity -= 15;
                            gameState.supernatural += 5;
                            break;
                        case 'curious':
                            gameState.sanity -= 5;
                            gameState.supernatural += 15;
                            gameState.tookAmulet = true;
                            break;
                        case 'lookAtMu':
                            gameState.relationship += 10;
                            break;
                        case 'takeChild':
                            gameState.supernatural += 20;
                            gameState.sanity -= 10;
                            gameState.hasSeenChild = true;
                            // 共享场景选择后推进到第3天
                            gameState.day = 3;
                            goToNextDay();
                            return;
                        case 'refuse':
                            gameState.supernatural -= 10;
                            gameState.sanity += 10;
                            // 共享场景选择后推进到第3天
                            gameState.day = 3;
                            goToNextDay();
                            return;
                    }
                }
                // 第3天及以后的选择影响保持不变
                else if (day === 3) {
                    switch(choice) {
                        case 'panic':
                            gameState.sanity -= 15;
                            gameState.relationship += 5;
                            gameState.hasSeenChild = true;
                            break;
                        case 'calm':
                            gameState.sanity += 10;
                            gameState.supernatural += 5;
                            gameState.hasSeenChild = true;
                            break;
                        case 'talkToChild':
                            gameState.sanity -= 5;
                            gameState.supernatural += 15;
                            gameState.hasSeenChild = true;
                            break;
                        case 'freeze':
                            gameState.sanity -= 20;
                            gameState.hasSeenChild = true;
                            break;
                        case 'talk':
                            gameState.sanity -= 5;
                            gameState.supernatural += 10;
                            gameState.hasSeenChild = true;
                            break;
                        case 'pressButton':
                            gameState.sanity += 5;
                            gameState.supernatural -= 5;
                            gameState.hasSeenChild = true;
                            break;
                    }
                }
                else if (day === 4) {
                    switch(choice) {
                        case 'consult':
                            gameState.supernatural += 10;
                            gameState.sanity += 5;
                            break;
                        case 'rational':
                            gameState.supernatural -= 10;
                            gameState.sanity += 10;
                            break;
                        case 'watchLing':
                            gameState.relationship += 10;
                            break;
                        case 'share':
                            gameState.supernatural += 5;
                            gameState.sanity -= 5;
                            break;
                        case 'silent':
                            gameState.sanity += 5;
                            gameState.relationship -= 5;
                            break;
                        case 'confrontMu':
                            gameState.relationship += 5;
                            gameState.supernatural += 5;
                            break;
                    }
                }
                else if (day === 5) {
                    switch(choice) {
                        case 'stay':
                            gameState.relationship -= 20;
                            gameState.sanity += 5;
                            break;
                        case 'leave':
                            gameState.relationship += 20;
                            gameState.sanity -= 5;
                            break;
                        case 'sendSiMing':
                            gameState.relationship += 5;
                            gameState.supernatural += 5;
                            break;
                        case 'escape':
                            gameState.relationship -= 15;
                            gameState.sanity -= 10;
                            break;
                        case 'face':
                            gameState.relationship += 15;
                            gameState.sanity += 5;
                            break;
                        case 'driveAway':
                            gameState.sanity -= 5;
                            gameState.supernatural += 5;
                            break;
                    }
                }
                else if (day === 6) {
                    // 第6天选择不影响数值，直接影响结局
                }
                
                // 限制数值范围
                gameState.relationship = Math.max(0, Math.min(100, gameState.relationship));
                gameState.supernatural = Math.max(0, Math.min(100, gameState.supernatural));
                gameState.sanity = Math.max(0, Math.min(100, gameState.sanity));
                
                updateStats();
            }

            // 检查成就解锁
            function checkAchievements(day, choice) {
                if (choice === 'intimate' && day === 1 && !gameState.achievements.includes('亲密无间')) {
                    gameState.achievements.push('亲密无间');
                }
                if (choice === 'takeChild' && day === 2 && !gameState.achievements.includes('接纳响荷')) {
                    gameState.achievements.push('接纳响荷');
                }
                if (choice === 'leave' && day === 5 && !gameState.achievements.includes('为爱私奔')) {
                    gameState.achievements.push('为爱私奔');
                }
            }

            // 前往下一天
            function goToNextDay() {
                // 隐藏当前天的场景
                document.getElementById(`day${gameState.day - 1}`).classList.remove('active');
                
                // 显示下一天的场景
                const nextDayElement = document.getElementById(`day${gameState.day}`);
                if (nextDayElement) {
                    nextDayElement.classList.add('active');
                    
                    // 隐藏所有角色选项
                    document.querySelectorAll('.character-choices').forEach(el => el.classList.add('hidden'));
                    
                    // 如果是第二天或第一天，显示角色选择器
                    if (gameState.day === 1 || gameState.day === 2) {
                        document.querySelector('.character-select').classList.remove('hidden');
                    } else {
                        // 其他天数直接显示当前角色的选项
                        document.querySelector('.character-select').classList.add('hidden');
                        const charElement = document.getElementById(`day${gameState.day}-${gameState.character === '木子洋' ? 'mu' : 'ling'}`);
                        if (charElement) {
                            charElement.classList.remove('hidden');
                        }
                    }
                }
                
                updateStats();
            }

            // 显示结局
            function showEnding() {
                document.getElementById(`day${gameState.day}`).classList.remove('active');
                document.getElementById('ending').classList.add('active');
                
                let endingText = '';
                if (gameState.relationship > 70 && gameState.supernatural > 70) {
                    endingText = '<p>你们选择共同面对响荷的纠缠，尽管超自然现象从未停止，但你们的关系却因此更加紧密。在丽江的细雨中，你们找到了属于彼此的永恒。</p>';
                } else if (gameState.relationship > 70 && gameState.sanity > 70) {
                    endingText = '<p>你们成功摆脱了响荷的影响，回归了正常生活。虽然那段经历如梦似幻，但它加深了你们之间的理解与信任，成为彼此心中不可磨灭的秘密。</p>';
                } else if (gameState.supernatural > 70 && gameState.sanity < 30) {
                    endingText = '<p>响荷最终吞噬了你们的理智，你们永远迷失在了丽江的迷雾中，成为了当地新的传说。有人说，在阴雨连绵的夜晚，还能看到两个模糊的身影在古城中徘徊。</p>';
                } else if (gameState.relationship < 30) {
                    endingText = '<p>经历了这一切后，你们选择分道扬镳。丽江的回忆成为了彼此心中不愿触碰的伤疤，那段超自然的经历也随着时间的流逝渐渐被淡忘。</p>';
                } else {
                    endingText = '<p>你们离开了丽江，带着复杂的心情和未解的谜团。响荷的阴影似乎并未完全消散，但生活总要继续。你们偶尔还会联系，却再也没有提及那个穿碎花裙的小女孩。</p>';
                }
                
                document.getElementById('ending-text').innerHTML = endingText;
                
                let achievementsHtml = '';
                if (gameState.achievements.length > 0) {
                    gameState.achievements.forEach(achievement => {
                        achievementsHtml += `<div class="achievement">• ${achievement}</div>`;
                    });
                } else {
                    achievementsHtml = '<p>暂无成就解锁</p>';
                }
                document.getElementById('achievements-list').innerHTML = achievementsHtml;
            }

            // 重新开始游戏
            function restartGame() {
                gameState = {
                    day: 1,
                    character: null,
                    relationship: 50,
                    supernatural: 50,
                    sanity: 50,
                    choices: [],
                    achievements: [],
                    hasSeenChild: false,
                    tookAmulet: false
                };
                
                document.querySelectorAll('.scene').forEach(el => el.classList.remove('active'));
                document.getElementById('intro').classList.add('active');
                document.querySelectorAll('.character-choices').forEach(el => el.classList.add('hidden'));
                updateStats();
            }

            // 事件绑定
            document.getElementById('startButton').addEventListener('click', startGame);
            
            document.querySelectorAll('.character-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const char = this.getAttribute('data-char');
                    selectCharacter(char);
                });
            });
            
            document.querySelectorAll('.choice[data-day]').forEach(choice => {
                choice.addEventListener('click', function() {
                    const day = parseInt(this.getAttribute('data-day'));
                    const choiceId = this.getAttribute('data-choice');
                    makeChoice(day, choiceId);
                });
            });
            
            document.getElementById('restartButton').addEventListener('click', restartGame);
        });
    </script>
</body>
</html>
